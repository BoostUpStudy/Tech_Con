Container 와 VM(Virtual Machine) 은 독립적인 환경을 생성하는 소프트웨어 기술입니다. 현대 어플리케이션의 이식성, 확장성을 높여주어 DevOps 및 소프트웨어 생명 주기를 향상시켜줍니다.

하지만 Container 와 VM 은 용도가 다르며 차이점 역시 명확하게 가지고 있습니다. 필자는 해당 포스트를 통해 Container 와 VM 기술에 대한 설명과 차이점을 알아보겠습니다.

## VM(Virtual Machine)


<div align="center">
    <img width="500" alt="vm" src="https://user-images.githubusercontent.com/74395748/153005394-1b7aac3d-8955-4659-84fd-b715f7aaca44.png">
</div>

가상머신은 가상화된 컴퓨팅 환경을 구축하는 기술입니다. 즉, 물리적 컴퓨터의 애뮬레이션으로 배포하는 서비스를 Bare Metal 단위가 아닌 어플리케이션 단위로 구성할 수 있습니다.

가상머신은 **하이퍼바이저** 라는 소프트웨어 계층을 사용하여 물리적인 컴퓨터와 상호작용하며 호스트 운영 체제 혹은 다른 VM 으로부터 완전히 격리된 환경을 구성할 수 있습니다.

### 하이퍼바이저(Hypervisor)

가상화를 알기전 하이퍼바이저를 먼저 알아보겠습니다.

VMM(Virtual Machine Monitor)라고도 불리는 하이퍼바이저란 운영 체제와 가상 머신의 리소스를 분리하여 가상 머신을 생성하고 관리하는 소프트웨어입니다. 여기서 물리적 하드웨어는 호스트라 불리며 리소스를 사용하는 VM 을 게스트라고 불립니다.

하이퍼바이저는 호스트의 CPU, Memory 등의 하드웨어 리소스 풀을 관리합니다. 기존의 게스트 혹은 새로운 게스트들은 호스트의 물리 리소스를 하이퍼바이저가 관리하는 일정에 의하여 제공받습니다. 이때 각 게스트는 가상화 하드웨어 리소스를 공유하므로 서로 다른 운영체제를 구동할 수 있습니다.

하이퍼바이저는 두가지 유형으로 나뉩니다. 호스트의 하드웨어에서 직접 운영 체제를 관리하는 **native/bare-metal** 유형과 어플리케이션으로 구동되며 호스트의 운영 체제에서 게스트 운영 체제를 추상화 하는 방식으로 작동하는 **hosted** 유형입니다.

두 유형에 더 자세한 내용은 다른 포스트에서 다루겠습니다.

### 가상화(Virtualization)

가상화란 하드웨어에 종속된 리소스를 사용하여 IT 서비스를 유용하게 구성할 수 있는 기술입니다. 즉, 하드웨어 위에 소프트웨어를 사용하여 단일 컴퓨터의 하드웨어 요소를 여러 가상 컴퓨터가 동작하는 추상화 계층을 만드는 프로세스입니다.

가상 머신에서 계층을 구성하는 소프트웨어가 **하이퍼바이저** 입니다.

## Container

<div align="center">
  <img width="500" alt="container" src="https://user-images.githubusercontent.com/74395748/153005430-29118f80-565e-4631-998d-4a2b584877a8.png">
</div>

Container 는 실행에 필요한 모든 파일이 구성되며 런타임 환경에서 어플리케이션을 패키지화(**컨테이너화**)하여 분리합니다. 하이퍼바이저를 사용하지 않고 짧은 시간에 리소스 프로비저닝, 가용성을 챙길 수 있습니다.

이를 가능하게 하기 위해서는 프로세스가 접근하는 CPU, Memory, Disk 등의 자원을 제어하는 호스트의 OS 커널 기능을 공유하는 **OS 가상화**를 활용합니다.

즉, 가상머신과 다르게 게스트 OS 를 구성하는 것이 아닌 호스트 OS 만을 유지 및 관리하기 때문에 가상 머신에 비해서 보다 이식성이 좋고 확장성이 좋습니다.

### 컨테이너화

소프트웨어 혹은 어플리케이션의 코드를 종속된 라이브러리 혹은 프레임워크와 같은 요소와 함께 컨테이너 이미지로 패키징하여 **컨테이너**를 형성한다는 용어입니다.

패키징된 **컨테이너**는 이식성을 가진 완전한 컴퓨팅 환경이기 때문에 어떠한 인프라의 환경에 상관없이 일관성을 유지해야 됩니다.

- 컨테이너 오케스트레이션

  컨테이너 오케스트레이션이란 각각의 소프트웨어가 패키징된 컨테이너들을 배포, 관리, 확장, 네트워킹을 자동화해주는 기술입니다.
  마이크로서비스 기반 어플리케이션에 이상적인 배포 유닛, 독립적인 실행환경을 컨테이너 기술을 통해 보장받으며 라이프사이클, CI/CD 등과 같은 작업을 컨테이너 오케스트레이션을 통해 구성할 수 있습니다.


컨테이너화로 인하여 생성된 **컨테이너 이미지**에 대한 계층과 설명은 다른 포스트에서 자세히 다루겠습니다.

## VM vs Container

가상머신과 Container 가 무엇인지 간단하게 살펴보았습니다. 이제 해당 포스트의 핵심인 둘의 차이점과 사용처를 정리하겠습니다.

### 차이점

앞서 가상머신과 Container 에 대해서 서술한 내용에서 차이점이 명확히 존재합니다.

가상머신은 하이퍼바이저를 활용하여 물리적 하드웨어를 가상화하여 컴퓨팅 환경을 제공합니다. 그로인해 VM 은 소프트웨어의 코드와 라이브러리 등 종속 환경과 추가로 게스트 OS 를 포함합니다.

Container 는 운영체제를 가상화하기 때문에 소프트웨어의 코드, 라이브러리 등 종속 환경만 포함합니다.

### 장단점

가상 머신과 Container 의 방식의 차이에서 발생하는 장점, 단점을 살펴보겠습니다.

**VM(Virtual Machine) 장점**

- VM 은 하드웨어 가상화 기반으로 동작하므로 동일한 호스트에서 서로 다른 가상화 OS 환경을 구동할 수 있습니다.
- VM 은 게스트 OS 에 의해서 실행되기 때문에 호스트 OS 의 커널을 공유하지 않습니다. 즉, 호스트와 게스트의 격리로 인하여 VM 의 보안 취약점에 대해서 호스트는 보호받습니다.

**VM(Virtual Machine) 단점**

- 각 VM 은 운영 체제와 운영 체제에 필요한 모든 하드웨어의 가상 복사본이 포함됩니다. 그로인해 VM 에는 과도한 RAM, CPU 와 같은 호스트 리소스가 필요합니다.
- 운영 체제 관리로 인하여 호스트의 리소스 자원이 필요하기 때문에 소프트웨어 개발 생명 주기가 복잡해집니다.
- VM 을 클라우드, Bare Metal 등 다른 환경으로 이동하고 이식하는 작업은 보다 복잡합니다.

**Container 장점**

- Container 는 기본적으로 소프트웨어에 필요한 종속된 라이브러리와 코드로 구성됩니다. 추가로 Container 와 호스트 OS 의 커널이 다른 부분도 패키징됩니다. 게스트 OS 와 가상 하드웨어를 구성하는 VM 에 비해서 가벼운 환경이 구성됩니다.
- Container 는 호스트 OS 커널을 공유하기 때문에 VM 에 비해서 io 작업에 이점이 존재합니다. VM 에서 io 작업이 발생하면 게스트 OS 커널 뿐만 아니라 물리적 하드웨어인 호스트 OS 커널 작업이 동작합니다. 하지만 Container 는 호스트 OS 커널 작업만 동작하기 때문에 속도적 이점을 기대할 수 있습니다.
- 소프트웨어 배포 환경에서 Container 가 이점을 얻을 수 있습니다. VM 에 비해서 가벼운 패키징된 컨테이너 이미지로 동작하기 때문에 CI/CD 작업을 거쳐 이미지를 변경하여 배포할 수 있습니다. 또한 컨테이너 오케스트레이션을 통해 여러 호스트에서 동작하는 컨테이너들을 보다 쉽게 관리할 수 있습니다.

**Container 단점**

- 호스트 OS 에 의하여 소프트웨어가 동작하기 때문에 동일한 호스트에 존재하는 모든 컨테이너는 동일한 OS 에서 실행되도록 설계해야 됩니다.
- OS 가 공유되기 때문에 커널의 보안 취약점은 호스트에서 동작하는 모든 컨테이너에 영향을 미칩니다. 즉, 호스트와 소프트웨어의 격리 레벨이 VM 에 비해서 낮습니다.

## 참고자료

[Docket, VM 장점](https://medium.com/@darkrasid/docker%EC%99%80-vm-d95d60e56fdd)

[Microsoft Container vs VM(요약)](https://docs.microsoft.com/ko-kr/virtualization/windowscontainers/about/containers-vs-vm)

[IBM Container vs VM](https://www.ibm.com/cloud/blog/containers-vs-vms)

[RedHat 하이퍼바이저](https://www.redhat.com/ko/topics/virtualization/what-is-a-hypervisor)

[RedHat 가상화](https://www.redhat.com/ko/topics/virtualization/what-is-virtualization)

[IBM Container](https://www.ibm.com/kr-ko/cloud/learn/containers#toc--AL-6P7M_)

[RedHat 컨테이너화](https://www.redhat.com/ko/topics/cloud-native-apps/what-is-containerization)

[Container vs VM](https://www.burwood.com/blog-archive/containerization-vs-virtualization)